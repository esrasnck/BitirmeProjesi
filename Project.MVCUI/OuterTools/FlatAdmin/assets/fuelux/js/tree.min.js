/*
 * Fuel UX Spinner
 * https://github.com/ExactTarget/fuelux
 * Improved by keenthemes for Conquer theme
 * Copyright (c) 2012 ExactTarget
 * Licensed under the MIT license.
 */
 
!function(e){var t=function(t,s){this.$element=e(t),this.options=e.extend({},e.fn.tree.defaults,s),this.$element.on("click",".tree-item",e.proxy(function(e){this.selectItem(e.currentTarget)},this)),this.$element.on("click",".tree-folder-header",e.proxy(function(e){this.selectFolder(e.currentTarget)},this)),this.render()};t.prototype={constructor:t,render:function(){this.populate(this.$element)},populate:function(t){var s=this,a=t.parent(),n=a.find(".tree-loader:eq(0)");n.show(),this.options.dataSource.data(t.data(),function(o){n.hide(),e.each(o.data,function(n,o){var r;"folder"===o.type?(r=s.$element.find(".tree-folder:eq(0)").clone().show(),r.find(".tree-folder-name").html(o.name),r.find(".tree-loader").html(s.options.loadingHTML),r.find(".tree-folder-header").data(o)):"item"===o.type&&(r=s.$element.find(".tree-item:eq(0)").clone().show(),r.find(".tree-item-name").html(o.name),r.data(o));var i=o.dataAttributes||[];e.each(i,function(e,t){switch(e){case"class":case"classes":case"className":r.addClass(t);break;default:r.attr(e,t)}}),t.hasClass("tree-folder-header")?a.find(".tree-folder-content:eq(0)").append(r):t.append(r)}),s.$element.trigger("loaded",a)})},selectItem:function(t){var s=e(t),a=this.$element.find(".tree-selected"),n=[];if(this.options.multiSelect?e.each(a,function(t,a){var o=e(a);o[0]!==s[0]&&n.push(e(a).data())}):a[0]!==s[0]&&(a.removeClass("tree-selected").find("i").removeClass("icon-ok").addClass("tree-dot"),n.push(s.data())),this.options.selectable){var o="selected";s.hasClass("tree-selected")?(o="unselected",s.removeClass("tree-selected"),s.find("i").removeClass("icon-ok").addClass("tree-dot")):(s.addClass("tree-selected"),s.find("i").removeClass("tree-dot").addClass("icon-ok"),this.options.multiSelect&&n.push(s.data()))}n.length&&this.$element.trigger("selected",{info:n}),s.trigger("updated",{info:n,item:s,eventType:o})},selectFolder:function(t){var s,a,n,o=e(t),r=o.parent(),i=r.find(".tree-folder-content"),l=i.eq(0);o.find(".icon-folder-close").length?(s="opened",a=".icon-folder-close",n="icon-folder-open",l.show(),i.children().length||this.populate(o)):(s="closed",a=".icon-folder-open",n="icon-folder-close",l.hide(),this.options.cacheItems||l.empty()),r.find(a).eq(0).removeClass("icon-folder-close icon-folder-open").addClass(n),this.$element.trigger(s,o.data())},selectedItems:function(){var t=this.$element.find(".tree-selected"),s=[];return e.each(t,function(t,a){s.push(e(a).data())}),s},collapse:function(){var t=this.options.cacheItems;this.$element.find(".icon-folder-open").each(function(){var s=e(this).removeClass("icon-folder-close icon-folder-open").addClass("icon-folder-close"),a=s.parent().parent(),n=a.children(".tree-folder-content");n.hide(),t||n.empty()})}},e.fn.tree=function(s,a){var n,o=this.each(function(){var o=e(this),r=o.data("tree"),i="object"==typeof s&&s;r||o.data("tree",r=new t(this,i)),"string"==typeof s&&(n=r[s](a))});return void 0===n?o:n},e.fn.tree.defaults={selectable:!0,multiSelect:!1,loadingHTML:"<div>Loading...</div>",cacheItems:!0},e.fn.tree.Constructor=t}(window.jQuery);